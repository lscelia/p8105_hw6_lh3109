p8105_hw6_lh3109
================

``` r
library(tidyverse)
library(modelr)
library(mgcv)
```

# Problem 1

## Propose a regression model

### Load and tidy data

``` r
bw_df = 
  #import data
  read_csv("./data/birthweight.csv") %>% 
  #remove possible na values
  drop_na() %>% 
  #factor appropriate numeric variables
  mutate(
    babysex = as.factor(babysex),
    frace = as.factor(frace),
    malform = as.factor(malform),
    mrace = as.factor(mrace)
  )
```

This data set contains 4342 observations with 22 variables. It does not
contains NA values.

### Select predictors

``` r
#test model by considering all variables as predictors
fit_test = lm(bwt ~ . , data = bw_df)

#summry results and look for statistically significant predictors of bwt
summary(fit_test)
```

    ## 
    ## Call:
    ## lm(formula = bwt ~ ., data = bw_df)
    ## 
    ## Residuals:
    ##      Min       1Q   Median       3Q      Max 
    ## -1097.68  -184.86    -3.33   173.09  2344.15 
    ## 
    ## Coefficients: (3 not defined because of singularities)
    ##               Estimate Std. Error t value Pr(>|t|)    
    ## (Intercept) -6265.3914   660.4011  -9.487  < 2e-16 ***
    ## babysex2       28.7073     8.4652   3.391 0.000702 ***
    ## bhead         130.7781     3.4523  37.881  < 2e-16 ***
    ## blength        74.9536     2.0217  37.075  < 2e-16 ***
    ## delwt           4.1007     0.3948  10.386  < 2e-16 ***
    ## fincome         0.2898     0.1795   1.614 0.106551    
    ## frace2         14.3313    46.1501   0.311 0.756168    
    ## frace3         21.2361    69.2960   0.306 0.759273    
    ## frace4        -46.9962    44.6782  -1.052 0.292912    
    ## frace8          4.2969    74.0741   0.058 0.953745    
    ## gaweeks        11.5494     1.4654   7.882 4.06e-15 ***
    ## malform1        9.7650    70.6259   0.138 0.890039    
    ## menarche       -3.5508     2.8951  -1.226 0.220083    
    ## mheight         9.7874    10.3116   0.949 0.342588    
    ## momage          0.7593     1.2221   0.621 0.534418    
    ## mrace2       -151.4354    46.0453  -3.289 0.001014 ** 
    ## mrace3        -91.3866    71.9190  -1.271 0.203908    
    ## mrace4        -56.4787    45.1369  -1.251 0.210901    
    ## parity         95.5411    40.4793   2.360 0.018307 *  
    ## pnumlbw             NA         NA      NA       NA    
    ## pnumsga             NA         NA      NA       NA    
    ## ppbmi           4.3538    14.8913   0.292 0.770017    
    ## ppwt           -3.4716     2.6121  -1.329 0.183913    
    ## smoken         -4.8544     0.5871  -8.269  < 2e-16 ***
    ## wtgain              NA         NA      NA       NA    
    ## ---
    ## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
    ## 
    ## Residual standard error: 272.5 on 4320 degrees of freedom
    ## Multiple R-squared:  0.7183, Adjusted R-squared:  0.717 
    ## F-statistic: 524.6 on 21 and 4320 DF,  p-value: < 2.2e-16

### Fit model

Consider birthweight as an outcome that depend on the predictors that
are statistically significant

``` r
#fit the model
fit = lm(bwt ~ babysex + bhead + blength + delwt + gaweeks + parity + smoken, data = bw_df)

#check the results
summary(fit)
```

    ## 
    ## Call:
    ## lm(formula = bwt ~ babysex + bhead + blength + delwt + gaweeks + 
    ##     parity + smoken, data = bw_df)
    ## 
    ## Residuals:
    ##      Min       1Q   Median       3Q      Max 
    ## -1180.35  -183.47    -9.59   174.39  2508.92 
    ## 
    ## Coefficients:
    ##               Estimate Std. Error t value Pr(>|t|)    
    ## (Intercept) -6294.0426    97.0551 -64.850  < 2e-16 ***
    ## babysex2       29.7598     8.7324   3.408 0.000660 ***
    ## bhead         137.0235     3.5340  38.773  < 2e-16 ***
    ## blength        78.8683     2.0709  38.083  < 2e-16 ***
    ## delwt           2.0744     0.1993  10.411  < 2e-16 ***
    ## gaweeks        14.3571     1.5011   9.564  < 2e-16 ***
    ## parity        102.3021    41.7131   2.453 0.014225 *  
    ## smoken         -2.1688     0.5820  -3.727 0.000196 ***
    ## ---
    ## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
    ## 
    ## Residual standard error: 281.8 on 4334 degrees of freedom
    ## Multiple R-squared:  0.6977, Adjusted R-squared:  0.6973 
    ## F-statistic:  1429 on 7 and 4334 DF,  p-value: < 2.2e-16

### Plot residuals vs. fitted values

``` r
bw_df %>% 
  modelr::add_residuals(fit) %>% 
  modelr::add_predictions(fit) %>% 
  ggplot(aes(x = pred, y = resid)) +
  geom_point(alpha = 0.2) +
  geom_smooth(method = "lm", se = FALSE, formula = y ~ x) +
  labs(title = "Model Residuals vs. Fitted Values",
       x = "Fitted Values",
       y = "Residuals")
```

![](p8105_hw6_lh3109_files/figure-gfm/unnamed-chunk-4-1.png)<!-- --> As
shown in the plot, with fitted value below 2000 or above 4000, the
residuals do not “bounce randomly” around the 0 line, suggesting that
the data point in this range do not fall on the estimated regression
line. This model is not optimal for data outside of the 2000-4000 range
for fitted values. However, when fitted values are around 3000, many
data points have residuals equals to 0, showing that they falls directly
on the estimated regression line, and the model predictions are correct.

## Compare the model with two others

# Prolem 2
